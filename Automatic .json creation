#define _CRT_SECURE_NO_WARNINGS
#include <stdio.h>
#include <stdlib.h>
#include <time.h>
#include <direct.h>    // _mkdir
#include <errno.h>
#include <string.h>
#define MAX_PATH 260
enum Quality { QIHAO, LIANGHAO, YIBAN, PUTONG, BUJIGE };

static const char* qualityNames[] = {
    "极好",
    "良好",
    "一般",
    "普通",
    "不及格"
};

int main(void) {
    const char* outDir = "D:\\";
    const char* outFile = "testdata.json";
    char fullpath[MAX_PATH];

    /* 如果目标目录不存在，可取消注释以下两行进行创建 */
    // if (_mkdir(outDir) != 0 && errno != EEXIST) {
    //     fprintf(stderr, "无法创建目录 %s: %s\n", outDir, strerror(errno));
    //     return EXIT_FAILURE;
    // }

    /* 拼接完整路径 */
    snprintf(fullpath, sizeof(fullpath), "%s%s", outDir, outFile);

    /* 初始化随机种子 */
    srand((unsigned)time(NULL));

    /* 生成 100000–999999 的随机 ClientID */
    int clientID = rand() % 900000 + 100000;

    /* 随机选取质量等级 */
    int q = rand() % (sizeof(qualityNames) / sizeof(qualityNames[0]));

    /* 获取并格式化当前时间 */
    time_t t = time(NULL);
    struct tm tm_info;
    localtime_s(&tm_info, &t);
    char datetime[20];
    strftime(datetime, sizeof(datetime), "%Y-%m-%d %H:%M:%S", &tm_info);

    /* 写入 JSON 文件 */
    FILE* fp = fopen(fullpath, "w");
    if (!fp) {
        fprintf(stderr, "无法打开文件 %s: %s\n", fullpath, strerror(errno));
        return EXIT_FAILURE;
    }

    fprintf(fp,
        "{\n"
        "  \"time\": \"%s\",\n"
        "  \"clientID\": %d,\n"
        "  \"quality\": \"%s\"\n"
        "}\n",
        datetime,
        clientID,
        qualityNames[q]
    );

    fclose(fp);
    return EXIT_SUCCESS;
}
